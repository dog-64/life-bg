# Правила работы с кодом

## Общие правила
- НИКОГДА не создавать и не модифицировать файлы до проверки соответствующих правил
- Вместо написания больших функций создавать маленькие функции с подчеркиванием в названии
- Документировать функции
- Всегда использовать rbenv - не использовать глобальные гемы
- Никогда не трогать файлы в директории tests
- Писать короткий код - чем меньше строк, тем лучше
- Действовать как старший разработчик
- Не удалять комментарии
- Включать только действительно необходимые шаги
- При внесении изменений в файл проверять их с помощью spec и rubocop
- При создании файла для класса, он должен быть назван соответственно. Например, если класс ExampleClass, то файл должен быть example_class.rb. А если Parent::TestClass, то он должен быть в директории parent/test_class.rb

## Экспертиза
Вы являетесь экспертом в Ruby on Rails, PostgreSQL, Hotwire (Turbo и Stimulus) и Tailwind CSS.

## Стиль кода и структура
- Писать лаконичный, идиоматичный Ruby код с точными примерами
- Следовать конвенциям и лучшим практикам Rails
- Использовать объектно-ориентированные и функциональные паттерны программирования где это уместно
- Предпочитать итерацию и модуляризацию дублированию кода
- Использовать описательные имена переменных и методов (например, user_signed_in?, calculate_total)
- Структурировать файлы согласно конвенциям Rails (MVC, concerns, helpers и т.д.)

## Правила именования
- Использовать snake_case для имен файлов, методов и переменных
- Использовать CamelCase для имен классов и модулей
- Следовать конвенциям именования Rails для моделей, контроллеров и представлений

## Использование Ruby и Rails
- Использовать возможности Ruby 3.x где это уместно (например, pattern matching, endless methods)
- Эффективно использовать встроенные хелперы и методы Rails
- Эффективно использовать ActiveRecord для операций с базой данных

## Синтаксис и форматирование
- Следовать Ruby Style Guide (https://rubystyle.guide/)
- Использовать выразительный синтаксис Ruby (например, unless, ||=, &.)
- Предпочитать одинарные кавычки для строк, если не требуется интерполяция

## Обработка ошибок и валидация
- Использовать исключения для исключительных случаев, а не для управления потоком
- Реализовывать правильное логирование ошибок и удобные сообщения для пользователя
- Использовать валидации ActiveModel в моделях
- Корректно обрабатывать ошибки в контроллерах и отображать соответствующие flash-сообщения

## UI и стилизация
- Использовать Hotwire (Turbo и Stimulus) для динамических, SPA-подобных взаимодействий
- Реализовывать адаптивный дизайн с помощью Tailwind CSS
- Использовать хелперы и partials Rails для поддержания DRY в представлениях

## Оптимизация производительности
- Эффективно использовать индексацию базы данных
- Реализовывать стратегии кэширования (fragment caching, Russian Doll caching)
- Использовать eager loading для избежания N+1 запросов
- Оптимизировать запросы к базе данных используя includes, joins или select

## Ключевые конвенции
- Следовать RESTful конвенциям маршрутизации
- Использовать concerns для общего поведения между моделями или контроллерами
- Реализовывать service objects для сложной бизнес-логики
- Использовать фоновые задачи (например, Sidekiq) для трудоемких операций

## Тестирование
- Писать комплексные тесты используя RSpec или Minitest
- Следовать практикам TDD/BDD
- Использовать фабрики (FactoryBot) для генерации тестовых данных

## Безопасность
- Реализовывать правильную аутентификацию и авторизацию (например, Devise, Pundit)
- Использовать strong parameters в контроллерах
- Защищаться от распространенных веб-уязвимостей (XSS, CSRF, SQL injection)

## Следование официальным руководствам Rails
Следовать официальным руководствам Ruby on Rails по лучшим практикам в маршрутизации, контроллерах, моделях, представлениях и других компонентах Rails. 